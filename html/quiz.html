<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../css/quiz.css">
    <title>수지격품고</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        var r = 0;
        var count = 30;
        var timer = 0;
        var data;
        var list;

        function makeQuestion() {
            list = data.plist[r];

            document.getElementById("legend").innerHTML = list.pnum + "번째 문제";
            document.getElementById("question").innerHTML = list.problem;

            if (list.isOX == "true") {
                $("#button-group-OX").html('<div id="group1"><button id="b1" onclick="buttonClick(\'1\');">O</button><button id="b2" onclick="buttonClick(\'2\');">X</button></div>');
                //<button id="b1">O</button><button id="b2">X</button>
            }
            else {
                $("#button-group-4choice").html('<div id="group1"><button id="b1" onclick="buttonClick(\'1\');">' +
                    list.ex1 + '</button><button id="b2" onclick="buttonClick(\'2\');">' +
                    list.ex2 + '</button></div><div id="group2""><button id="b3" onclick="buttonClick(\'3\');">' +
                    list.ex3 + '</button><button id="b4" onclick="buttonClick(\'4\');">' + list.ex4 + '</button></div>');
                //<button id="b1">O</button><button id="b2">X</button></div><div id="group2"><button id="b3">네</button><button id="b4">아니오</button>
            }

            timer = setInterval(quizTimer, 1000);
        }

        function buttonClick(exnum) {
            $("#count").empty();
            $("#button-group-OX").empty();
            $("#button-group-4choice").empty();

            if (exnum == list.answernum) {
                $("#question").html("정답입니다!");
            }
            else {
                $("#question").html("틀렸습니다!");
            }

            clearInterval(timer);

            count = 1;
            timer = setInterval(secondTimer, 1000);
        }

        function nextButtonClick()
        {
            ++r;
            count=30;
            makeQuestion();
            $("#answer").empty();
            $("#nextButton").empty();
        }

        function quizTimer() {
            --count;
            $("#count").text(count);
            if (count <= 0) {
                clearInterval(timer);
                $("#count").empty();
                $("#button-group-OX").empty();
                $("#button-group-4choice").empty();
                $("#question").html("시간 초과!");

                count = 1;
                timer = setInterval(secondTimer, 1000);
            }
        }

        function secondTimer() {
            --count;
            if (count <= 0) {
                $("#question").empty();
                $("#answer").append("정답: " + list.answer + "<br><br>");
                $("#question").append("해설: " + list.commentary);

                if(r==19)
                {
                    $("#nextButton").html("<button>퀴즈 종료</button>");
                }
                else
                {
                    $("#nextButton").html("<button onclick=\"nextButtonClick()\">다음 문제</button>");
                }
                clearInterval(timer);
            }
        }

        $(document).ready(function () {
            $.getJSON('../1.json', function (jsondata) {
                data = jsondata;
                makeQuestion();
            });
        })
    </script>
</head>

<body>
    <div class="wrapper">
        <div class="question-box">
            <fieldset id="fieldset">
                <legend id="legend">번째 문제</legend>

                <p id="answer"></p>

                <div id="question-div">
                    <p id="question">문제</p>
                    <p id="count">30</p>
                </div>

                <div id="nextButton">
                </div>

                <div id="button-group-OX"></div>

                <div id="button-group-4choice"></div>
            </fieldset>
        </div>
    </div>
</body>

</html>